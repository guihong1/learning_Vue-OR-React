<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Router Ë∑ØÁî±ÂÆàÂç´ÁªÉ‰π†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.router-link-active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .permission-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .permission-admin {
            background: #ffeaa7;
            color: #856404;
        }

        .permission-user {
            background: #a8e6cf;
            color: #155724;
        }

        .permission-guest {
            background: #ddd6fe;
            color: #553c9a;
        }

        .route-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }

        .breadcrumb {
            background: rgba(255, 255, 255, 0.7);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .guard-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .guard-log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .guard-log-entry:last-child {
            border-bottom: none;
        }

        .guard-log-time {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .guard-log-type {
            font-weight: bold;
            margin: 0 0.5rem;
        }

        .guard-log-global {
            color: #007bff;
        }

        .guard-log-route {
            color: #28a745;
        }

        .guard-log-component {
            color: #ffc107;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <header class="header">
            <nav class="nav">
                <div class="logo">üõ°Ô∏è Ë∑ØÁî±ÂÆàÂç´Á≥ªÁªü</div>
                <ul class="nav-links">
                    <li><router-link to="/">È¶ñÈ°µ</router-link></li>
                    <li><router-link to="/public">ÂÖ¨ÂºÄÈ°µÈù¢</router-link></li>
                    <li><router-link to="/protected">Âèó‰øùÊä§È°µÈù¢</router-link></li>
                    <li><router-link to="/admin">ÁÆ°ÁêÜÂêéÂè∞</router-link></li>
                    <li><router-link to="/user/profile">Áî®Êà∑‰∏≠ÂøÉ</router-link></li>
                    <li><router-link to="/analytics">Êï∞ÊçÆÂàÜÊûê</router-link></li>
                </ul>
                <div class="user-info">
                    <div class="user-avatar">{{ currentUser.name.charAt(0) }}</div>
                    <span>{{ currentUser.name }}</span>
                    <span class="permission-badge" :class="`permission-${currentUser.role}`">
                        {{ getRoleText(currentUser.role) }}
                    </span>
                    <button @click="toggleRole" class="btn btn-secondary">ÂàáÊç¢ËßíËâ≤</button>
                    <button @click="logout" class="btn btn-danger">ÈÄÄÂá∫</button>
                </div>
            </nav>
        </header>

        <main class="main-content">
            <!-- Ë∑ØÁî±ÂÆàÂç´Êó•Âøó -->
            <div class="card">
                <h3>üîç Ë∑ØÁî±ÂÆàÂç´ÊâßË°åÊó•Âøó</h3>
                <div class="guard-log">
                    <div v-for="log in guardLogs" :key="log.id" class="guard-log-entry">
                        <span class="guard-log-time">{{ log.time }}</span>
                        <span class="guard-log-type" :class="`guard-log-${log.type}`">
                            {{ log.type.toUpperCase() }}
                        </span>
                        <span>{{ log.message }}</span>
                    </div>
                </div>
                <button @click="clearLogs" class="btn btn-secondary" style="margin-top: 1rem;">Ê∏ÖÁ©∫Êó•Âøó</button>
            </div>

            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ stats.totalNavigations }}</div>
                    <div class="stat-label">ÊÄªÂØºËà™Ê¨°Êï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.blockedNavigations }}</div>
                    <div class="stat-label">Ë¢´ÈòªÊ≠¢ÁöÑÂØºËà™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.successfulNavigations }}</div>
                    <div class="stat-label">ÊàêÂäüÁöÑÂØºËà™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.redirectedNavigations }}</div>
                    <div class="stat-label">ÈáçÂÆöÂêëÁöÑÂØºËà™</div>
                </div>
            </div>

            <!-- Ë∑ØÁî±ËßÜÂõæ -->
            <router-view></router-view>
        </main>
    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
        const { createRouter, createWebHashHistory, useRoute, useRouter, onBeforeRouteEnter, onBeforeRouteUpdate, onBeforeRouteLeave } = VueRouter;

        // ÂÖ®Â±ÄÁä∂ÊÄÅÁÆ°ÁêÜ
        const globalState = reactive({
            currentUser: {
                id: 1,
                name: 'Âº†‰∏â',
                role: 'user', // guest, user, admin
                isAuthenticated: true
            },
            guardLogs: [],
            stats: {
                totalNavigations: 0,
                blockedNavigations: 0,
                successfulNavigations: 0,
                redirectedNavigations: 0
            },
            logId: 1
        });

        // Â∑•ÂÖ∑ÂáΩÊï∞
        const addGuardLog = (type, message) => {
            const now = new Date();
            const time = now.toLocaleTimeString();
            globalState.guardLogs.unshift({
                id: globalState.logId++,
                type,
                message,
                time
            });
            // Âè™‰øùÁïôÊúÄËøë50Êù°Êó•Âøó
            if (globalState.guardLogs.length > 50) {
                globalState.guardLogs.pop();
            }
        };

        const hasPermission = (requiredRole) => {
            const roleHierarchy = { guest: 0, user: 1, admin: 2 };
            const userLevel = roleHierarchy[globalState.currentUser.role] || 0;
            const requiredLevel = roleHierarchy[requiredRole] || 0;
            return userLevel >= requiredLevel;
        };

        const simulateAsyncCheck = (delay = 1000) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(Math.random() > 0.1); // 90% ÊàêÂäüÁéá
                }, delay);
            });
        };

        // ÁªÑ‰ª∂ÂÆö‰πâ
        const Home = {
            template: `
                <div class="card">
                    <h2>üè† È¶ñÈ°µ</h2>
                    <p>Ê¨¢ËøéÊù•Âà∞Vue RouterË∑ØÁî±ÂÆàÂç´ÁªÉ‰π†Á≥ªÁªüÔºÅ</p>
                    
                    <div class="route-info">
                        <h4>üìã ÁªÉ‰π†ÂÜÖÂÆπ</h4>
                        <ul>
                            <li><strong>ÂÖ®Â±ÄÂâçÁΩÆÂÆàÂç´Ôºö</strong>Âú®ÊØèÊ¨°Ë∑ØÁî±Ë∑≥ËΩ¨ÂâçÊâßË°åÊùÉÈôêÊ£ÄÊü•</li>
                            <li><strong>ÂÖ®Â±ÄÂêéÁΩÆÈí©Â≠êÔºö</strong>Âú®Ë∑ØÁî±Ë∑≥ËΩ¨ÂÆåÊàêÂêéËÆ∞ÂΩïËÆøÈóÆÊó•Âøó</li>
                            <li><strong>Ë∑ØÁî±Áã¨‰∫´ÂÆàÂç´Ôºö</strong>‰∏∫ÁâπÂÆöË∑ØÁî±ÈÖçÁΩÆ‰∏ìÈó®ÁöÑÂÆàÂç´ÈÄªËæë</li>
                            <li><strong>ÁªÑ‰ª∂ÂÜÖÂÆàÂç´Ôºö</strong>Âú®ÁªÑ‰ª∂ÂÜÖÈÉ®Â§ÑÁêÜË∑ØÁî±ÂèòÂåñ</li>
                            <li><strong>ÂºÇÊ≠•Ë∑ØÁî±ÂÆàÂç´Ôºö</strong>Â§ÑÁêÜÈúÄË¶ÅÂºÇÊ≠•È™åËØÅÁöÑÂú∫ÊôØ</li>
                            <li><strong>ÊùÉÈôêÊéßÂà∂Ôºö</strong>Âü∫‰∫éÁî®Êà∑ËßíËâ≤ÁöÑËÆøÈóÆÊéßÂà∂</li>
                        </ul>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>üîì ÂÖ¨ÂºÄÈ°µÈù¢</h4>
                            <p>ÊâÄÊúâÁî®Êà∑ÈÉΩÂèØ‰ª•ËÆøÈóÆÁöÑÈ°µÈù¢</p>
                            <router-link to="/public" class="btn btn-primary">ËÆøÈóÆÂÖ¨ÂºÄÈ°µÈù¢</router-link>
                        </div>
                        <div class="card">
                            <h4>üîí Âèó‰øùÊä§È°µÈù¢</h4>
                            <p>ÈúÄË¶ÅÁôªÂΩïÊâçËÉΩËÆøÈóÆÁöÑÈ°µÈù¢</p>
                            <router-link to="/protected" class="btn btn-primary">ËÆøÈóÆÂèó‰øùÊä§È°µÈù¢</router-link>
                        </div>
                        <div class="card">
                            <h4>üëë ÁÆ°ÁêÜÂêéÂè∞</h4>
                            <p>Âè™ÊúâÁÆ°ÁêÜÂëòÊâçËÉΩËÆøÈóÆÁöÑÈ°µÈù¢</p>
                            <router-link to="/admin" class="btn btn-primary">ËÆøÈóÆÁÆ°ÁêÜÂêéÂè∞</router-link>
                        </div>
                    </div>
                </div>
            `
        };

        const PublicPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">È¶ñÈ°µ</router-link> / ÂÖ¨ÂºÄÈ°µÈù¢
                    </div>
                    
                    <h2>üîì ÂÖ¨ÂºÄÈ°µÈù¢</h2>
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ÊèêÁ§∫Ôºö</strong>ËøôÊòØ‰∏Ä‰∏™ÂÖ¨ÂºÄÈ°µÈù¢ÔºåÊâÄÊúâÁî®Êà∑ÈÉΩÂèØ‰ª•ËÆøÈóÆÔºåÊó†ÈúÄÁâπÊÆäÊùÉÈôê„ÄÇ
                    </div>
                    
                    <p>Ëøô‰∏™È°µÈù¢ÊºîÁ§∫‰∫ÜÊó†ÈúÄÊùÉÈôêÈ™åËØÅÁöÑË∑ØÁî±„ÄÇ‰ªª‰ΩïÁî®Êà∑ÔºåÊó†ËÆ∫ÊòØÂê¶ÁôªÂΩïÔºåÈÉΩÂèØ‰ª•ËÆøÈóÆËøô‰∏™È°µÈù¢„ÄÇ</p>
                    
                    <div class="route-info">
                        <h4>üõ°Ô∏è Ë∑ØÁî±ÂÆàÂç´ÈÖçÁΩÆ</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/public',
  component: PublicPage,
  meta: { 
    requiresAuth: false,
    title: 'ÂÖ¨ÂºÄÈ°µÈù¢'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>üìä ËÆøÈóÆÁªüËÆ°</h4>
                            <p>‰ªäÊó•ËÆøÈóÆÈáèÔºö<strong>1,234</strong></p>
                            <p>ÊÄªËÆøÈóÆÈáèÔºö<strong>45,678</strong></p>
                        </div>
                        <div class="card">
                            <h4>üì¢ ÂÖ¨Âëä</h4>
                            <p>Ê¨¢Ëøé‰ΩøÁî®Êàë‰ª¨ÁöÑÁ≥ªÁªüÔºÅÂ¶ÇÊúâÈóÆÈ¢òËØ∑ËÅîÁ≥ªÂÆ¢Êúç„ÄÇ</p>
                        </div>
                    </div>
                </div>
            `,
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `PublicPage - beforeRouteEnter: ‰ªé ${from.path} ËøõÂÖ• ${to.path}`);
                next();
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `PublicPage - beforeRouteLeave: ‰ªé ${from.path} Á¶ªÂºÄÂà∞ ${to.path}`);
                next();
            }
        };

        const ProtectedPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">È¶ñÈ°µ</router-link> / Âèó‰øùÊä§È°µÈù¢
                    </div>
                    
                    <h2>üîí Âèó‰øùÊä§È°µÈù¢</h2>
                    <div class="alert alert-success">
                        <strong>‚úÖ ÊàêÂäüÔºö</strong>ÊÇ®Â∑≤ÈÄöËøáË∫´‰ªΩÈ™åËØÅÔºåÂèØ‰ª•ËÆøÈóÆÊ≠§Âèó‰øùÊä§ÁöÑÈ°µÈù¢„ÄÇ
                    </div>
                    
                    <p>Ëøô‰∏™È°µÈù¢ÈúÄË¶ÅÁî®Êà∑ÁôªÂΩïÂêéÊâçËÉΩËÆøÈóÆ„ÄÇÂ¶ÇÊûúÁî®Êà∑Êú™ÁôªÂΩïÔºå‰ºöË¢´ÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µÈù¢„ÄÇ</p>
                    
                    <div class="route-info">
                        <h4>üõ°Ô∏è Ë∑ØÁî±ÂÆàÂç´ÈÖçÁΩÆ</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/protected',
  component: ProtectedPage,
  meta: { 
    requiresAuth: true,
    title: 'Âèó‰øùÊä§È°µÈù¢'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>üë§ Áî®Êà∑‰ø°ÊÅØ</h4>
                            <p>Áî®Êà∑ÂêçÔºö<strong>{{ currentUser.name }}</strong></p>
                            <p>ËßíËâ≤Ôºö<strong>{{ getRoleText(currentUser.role) }}</strong></p>
                            <p>ÁôªÂΩïÁä∂ÊÄÅÔºö<strong>{{ currentUser.isAuthenticated ? 'Â∑≤ÁôªÂΩï' : 'Êú™ÁôªÂΩï' }}</strong></p>
                        </div>
                        <div class="card">
                            <h4>üîê ÂÆâÂÖ®‰ø°ÊÅØ</h4>
                            <p>ÊúÄÂêéÁôªÂΩïÔºö<strong>2024-01-15 10:30:00</strong></p>
                            <p>ÁôªÂΩïIPÔºö<strong>192.168.1.100</strong></p>
                            <p>‰ºöËØùÊúâÊïàÊúüÔºö<strong>2Â∞èÊó∂</strong></p>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                return {
                    currentUser: globalState.currentUser,
                    getRoleText: (role) => {
                        const roleMap = { guest: 'ËÆøÂÆ¢', user: 'Áî®Êà∑', admin: 'ÁÆ°ÁêÜÂëò' };
                        return roleMap[role] || 'Êú™Áü•';
                    }
                };
            },
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `ProtectedPage - beforeRouteEnter: Ê£ÄÊü•Áî®Êà∑ÊùÉÈôê`);
                if (globalState.currentUser.isAuthenticated) {
                    next();
                } else {
                    addGuardLog('component', `ProtectedPage - beforeRouteEnter: Áî®Êà∑Êú™ÁôªÂΩïÔºåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ`);
                    next('/login');
                }
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `ProtectedPage - beforeRouteLeave: Á¶ªÂºÄÂèó‰øùÊä§È°µÈù¢`);
                next();
            }
        };

        const AdminPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">È¶ñÈ°µ</router-link> / ÁÆ°ÁêÜÂêéÂè∞
                    </div>
                    
                    <h2>üëë ÁÆ°ÁêÜÂêéÂè∞</h2>
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Ë≠¶ÂëäÔºö</strong>ËøôÊòØÁÆ°ÁêÜÂëò‰∏ìÁî®È°µÈù¢ÔºåÂåÖÂê´ÊïèÊÑüÊìç‰ΩúÔºåËØ∑Ë∞®ÊÖé‰ΩøÁî®„ÄÇ
                    </div>
                    
                    <p>Ëøô‰∏™È°µÈù¢Âè™ÊúâÁÆ°ÁêÜÂëòËßíËâ≤ÁöÑÁî®Êà∑ÊâçËÉΩËÆøÈóÆ„ÄÇÊôÆÈÄöÁî®Êà∑‰ºöË¢´ÊãíÁªùËÆøÈóÆ„ÄÇ</p>
                    
                    <div class="route-info">
                        <h4>üõ°Ô∏è Ë∑ØÁî±ÂÆàÂç´ÈÖçÁΩÆ</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/admin',
  component: AdminPage,
  beforeEnter: (to, from, next) => {
    if (hasPermission('admin')) {
      next();
    } else {
      next('/unauthorized');
    }
  },
  meta: { 
    requiresAuth: true,
    requiredRole: 'admin',
    title: 'ÁÆ°ÁêÜÂêéÂè∞'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>üë• Áî®Êà∑ÁÆ°ÁêÜ</h4>
                            <p>ÊÄªÁî®Êà∑Êï∞Ôºö<strong>1,234</strong></p>
                            <p>Ê¥ªË∑ÉÁî®Êà∑Ôºö<strong>856</strong></p>
                            <button class="btn btn-primary">ÁÆ°ÁêÜÁî®Êà∑</button>
                        </div>
                        <div class="card">
                            <h4>üìä Á≥ªÁªüÁªüËÆ°</h4>
                            <p>‰ªäÊó•ËÆøÈóÆÔºö<strong>5,678</strong></p>
                            <p>Á≥ªÁªüË¥üËΩΩÔºö<strong>45%</strong></p>
                            <button class="btn btn-primary">Êü•ÁúãËØ¶ÊÉÖ</button>
                        </div>
                        <div class="card">
                            <h4>‚öôÔ∏è Á≥ªÁªüËÆæÁΩÆ</h4>
                            <p>Á≥ªÁªüÁâàÊú¨Ôºö<strong>v2.1.0</strong></p>
                            <p>Êï∞ÊçÆÂ∫ìÁä∂ÊÄÅÔºö<strong>Ê≠£Â∏∏</strong></p>
                            <button class="btn btn-primary">Á≥ªÁªüÈÖçÁΩÆ</button>
                        </div>
                        <div class="card">
                            <h4>üîí ÂÆâÂÖ®‰∏≠ÂøÉ</h4>
                            <p>ÂÆâÂÖ®Á≠âÁ∫ßÔºö<strong>È´ò</strong></p>
                            <p>Â®ÅËÉÅÊ£ÄÊµãÔºö<strong>0‰∏™</strong></p>
                            <button class="btn btn-primary">ÂÆâÂÖ®ËÆæÁΩÆ</button>
                        </div>
                    </div>
                </div>
            `,
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `AdminPage - beforeRouteEnter: È™åËØÅÁÆ°ÁêÜÂëòÊùÉÈôê`);
                next();
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `AdminPage - beforeRouteLeave: Á¶ªÂºÄÁÆ°ÁêÜÂêéÂè∞`);
                // Ê®°ÊãüÁ°ÆËÆ§ÂØπËØùÊ°Ü
                const confirmed = confirm('ÊÇ®Á°ÆÂÆöË¶ÅÁ¶ªÂºÄÁÆ°ÁêÜÂêéÂè∞ÂêóÔºüÊú™‰øùÂ≠òÁöÑÊõ¥ÊîπÂ∞Ü‰∏¢Â§±„ÄÇ');
                if (confirmed) {
                    next();
                } else {
                    next(false);
                }
            }
        };

        const UserProfile = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">È¶ñÈ°µ</router-link> / Áî®Êà∑‰∏≠ÂøÉ / ‰∏™‰∫∫ËµÑÊñô
                    </div>
                    
                    <h2>üë§ ‰∏™‰∫∫ËµÑÊñô</h2>
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ÊèêÁ§∫Ôºö</strong>ËøôÈáåÂèØ‰ª•Êü•ÁúãÂíåÁºñËæëÊÇ®ÁöÑ‰∏™‰∫∫‰ø°ÊÅØ„ÄÇ
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>üìù Âü∫Êú¨‰ø°ÊÅØ</h4>
                            <div class="form-group">
                                <label>Áî®Êà∑Âêç</label>
                                <input type="text" :value="currentUser.name" readonly>
                            </div>
                            <div class="form-group">
                                <label>ËßíËâ≤</label>
                                <input type="text" :value="getRoleText(currentUser.role)" readonly>
                            </div>
                            <div class="form-group">
                                <label>ÈÇÆÁÆ±</label>
                                <input type="email" value="zhangsan@example.com">
                            </div>
                            <div class="form-group">
                                <label>ÁîµËØù</label>
                                <input type="tel" value="138-0000-0000">
                            </div>
                            <button class="btn btn-primary">‰øùÂ≠òÊõ¥Êîπ</button>
                        </div>
                        
                        <div class="card">
                            <h4>üîê ÂÆâÂÖ®ËÆæÁΩÆ</h4>
                            <div class="form-group">
                                <label>ÂΩìÂâçÂØÜÁ†Å</label>
                                <input type="password" placeholder="ËØ∑ËæìÂÖ•ÂΩìÂâçÂØÜÁ†Å">
                            </div>
                            <div class="form-group">
                                <label>Êñ∞ÂØÜÁ†Å</label>
                                <input type="password" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
                            </div>
                            <div class="form-group">
                                <label>Á°ÆËÆ§Êñ∞ÂØÜÁ†Å</label>
                                <input type="password" placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
                            </div>
                            <button class="btn btn-primary">‰øÆÊîπÂØÜÁ†Å</button>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const route = useRoute();
                
                onBeforeRouteUpdate((to, from) => {
                    addGuardLog('component', `UserProfile - beforeRouteUpdate: Ë∑ØÁî±ÂèÇÊï∞ÂèòÂåñ ${from.params.id} -> ${to.params.id}`);
                });
                
                return {
                    currentUser: globalState.currentUser,
                    getRoleText: (role) => {
                        const roleMap = { guest: 'ËÆøÂÆ¢', user: 'Áî®Êà∑', admin: 'ÁÆ°ÁêÜÂëò' };
                        return roleMap[role] || 'Êú™Áü•';
                    }
                };
            }
        };

        const AnalyticsPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">È¶ñÈ°µ</router-link> / Êï∞ÊçÆÂàÜÊûê
                    </div>
                    
                    <h2>üìä Êï∞ÊçÆÂàÜÊûê</h2>
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                        <span style="margin-left: 1rem;">Ê≠£Âú®Âä†ËΩΩÊï∞ÊçÆ...</span>
                    </div>
                    
                    <div v-else>
                        <div class="alert alert-success">
                            <strong>‚úÖ ÊàêÂäüÔºö</strong>Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÔºåÂºÇÊ≠•Ë∑ØÁî±ÂÆàÂç´È™åËØÅÈÄöËøá„ÄÇ
                        </div>
                        
                        <div class="route-info">
                            <h4>üõ°Ô∏è ÂºÇÊ≠•Ë∑ØÁî±ÂÆàÂç´</h4>
                            <p>Ëøô‰∏™È°µÈù¢ÊºîÁ§∫‰∫ÜÂºÇÊ≠•Ë∑ØÁî±ÂÆàÂç´ÁöÑ‰ΩøÁî®„ÄÇÂú®ËøõÂÖ•È°µÈù¢ÂâçÔºå‰ºöÂºÇÊ≠•È™åËØÅÁî®Êà∑ÊùÉÈôêÂíåÊï∞ÊçÆÂèØÁî®ÊÄß„ÄÇ</p>
                        </div>
                        
                        <div class="grid">
                            <div class="card">
                                <h4>üìà ËÆøÈóÆË∂ãÂäø</h4>
                                <p>‰ªäÊó•ËÆøÈóÆÔºö<strong>2,345</strong> (+12%)</p>
                                <p>Êò®Êó•ËÆøÈóÆÔºö<strong>2,089</strong></p>
                                <p>Êú¨Âë®ËÆøÈóÆÔºö<strong>15,678</strong></p>
                            </div>
                            <div class="card">
                                <h4>üë• Áî®Êà∑ÂàÜÊûê</h4>
                                <p>Êñ∞Áî®Êà∑Ôºö<strong>123</strong></p>
                                <p>Ê¥ªË∑ÉÁî®Êà∑Ôºö<strong>1,456</strong></p>
                                <p>ÁïôÂ≠òÁéáÔºö<strong>78%</strong></p>
                            </div>
                            <div class="card">
                                <h4>üåç Âú∞ÂüüÂàÜÂ∏É</h4>
                                <p>Âåó‰∫¨Ôºö<strong>35%</strong></p>
                                <p>‰∏äÊµ∑Ôºö<strong>28%</strong></p>
                                <p>ÂπøÂ∑ûÔºö<strong>15%</strong></p>
                                <p>ÂÖ∂‰ªñÔºö<strong>22%</strong></p>
                            </div>
                            <div class="card">
                                <h4>üì± ËÆæÂ§áÂàÜÊûê</h4>
                                <p>Ê°åÈù¢Á´ØÔºö<strong>65%</strong></p>
                                <p>ÁßªÂä®Á´ØÔºö<strong>30%</strong></p>
                                <p>Âπ≥ÊùøÔºö<strong>5%</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const loading = ref(true);
                
                onMounted(() => {
                    // Ê®°ÊãüÊï∞ÊçÆÂä†ËΩΩ
                    setTimeout(() => {
                        loading.value = false;
                    }, 2000);
                });
                
                return { loading };
            },
            async beforeRouteEnter(to, from, next) {
                addGuardLog('component', `AnalyticsPage - beforeRouteEnter: ÂºÄÂßãÂºÇÊ≠•È™åËØÅ`);
                
                try {
                    // Ê®°ÊãüÂºÇÊ≠•ÊùÉÈôêÊ£ÄÊü•
                    const hasAccess = await simulateAsyncCheck(1500);
                    
                    if (hasAccess) {
                        addGuardLog('component', `AnalyticsPage - beforeRouteEnter: ÂºÇÊ≠•È™åËØÅÊàêÂäü`);
                        next();
                    } else {
                        addGuardLog('component', `AnalyticsPage - beforeRouteEnter: ÂºÇÊ≠•È™åËØÅÂ§±Ë¥•ÔºåÊãíÁªùËÆøÈóÆ`);
                        next('/unauthorized');
                    }
                } catch (error) {
                    addGuardLog('component', `AnalyticsPage - beforeRouteEnter: ÂºÇÊ≠•È™åËØÅÂá∫Èîô - ${error.message}`);
                    next('/error');
                }
            }
        };

        const UnauthorizedPage = {
            template: `
                <div class="card">
                    <div class="alert alert-danger">
                        <h2>üö´ ËÆøÈóÆË¢´ÊãíÁªù</h2>
                        <p><strong>Êä±Ê≠âÔºåÊÇ®Ê≤°ÊúâÊùÉÈôêËÆøÈóÆÊ≠§È°µÈù¢„ÄÇ</strong></p>
                    </div>
                    
                    <div class="route-info">
                        <h4>ÂèØËÉΩÁöÑÂéüÂõ†Ôºö</h4>
                        <ul>
                            <li>ÊÇ®ÁöÑË¥¶Êà∑ÊùÉÈôê‰∏çË∂≥</li>
                            <li>ÈúÄË¶ÅÊõ¥È´òÁ∫ßÂà´ÁöÑÁî®Êà∑ËßíËâ≤</li>
                            <li>È°µÈù¢ÈúÄË¶ÅÁâπÊÆäÊéàÊùÉ</li>
                            <li>‰ºöËØùÂ∑≤ËøáÊúüÔºåÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩï</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <router-link to="/" class="btn btn-primary">ËøîÂõûÈ¶ñÈ°µ</router-link>
                        <button @click="requestAccess" class="btn btn-secondary" style="margin-left: 1rem;">Áî≥ËØ∑ÊùÉÈôê</button>
                    </div>
                </div>
            `,
            setup() {
                const requestAccess = () => {
                    alert('ÊùÉÈôêÁî≥ËØ∑Â∑≤Êèê‰∫§ÔºåËØ∑Á≠âÂæÖÁÆ°ÁêÜÂëòÂÆ°Ê†∏„ÄÇ');
                };
                
                return { requestAccess };
            }
        };

        const LoginPage = {
            template: `
                <div class="card">
                    <h2>üîê Áî®Êà∑ÁôªÂΩï</h2>
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ÊèêÁ§∫Ôºö</strong>ËØ∑ÁôªÂΩï‰ª•ËÆøÈóÆÂèó‰øùÊä§ÁöÑÈ°µÈù¢„ÄÇ
                    </div>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <div class="form-group">
                            <label>Áî®Êà∑Âêç</label>
                            <input type="text" v-model="username" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç">
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input type="password" v-model="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                        </div>
                        <button @click="login" class="btn btn-primary" style="width: 100%;">ÁôªÂΩï</button>
                    </div>
                    
                    <div class="route-info" style="margin-top: 2rem;">
                        <h4>üß™ ÊµãËØïË¥¶Êà∑</h4>
                        <p>Áî®Êà∑ÂêçÔºöuser / ÂØÜÁ†ÅÔºö123456 ÔºàÊôÆÈÄöÁî®Êà∑Ôºâ</p>
                        <p>Áî®Êà∑ÂêçÔºöadmin / ÂØÜÁ†ÅÔºö123456 ÔºàÁÆ°ÁêÜÂëòÔºâ</p>
                    </div>
                </div>
            `,
            setup() {
                const router = useRouter();
                const route = useRoute();
                const username = ref('');
                const password = ref('');
                
                const login = () => {
                    if (username.value && password.value) {
                        // Ê®°ÊãüÁôªÂΩïÈÄªËæë
                        globalState.currentUser.isAuthenticated = true;
                        globalState.currentUser.name = username.value;
                        globalState.currentUser.role = username.value === 'admin' ? 'admin' : 'user';
                        
                        addGuardLog('global', `Áî®Êà∑ ${username.value} ÁôªÂΩïÊàêÂäü`);
                        
                        // ÈáçÂÆöÂêëÂà∞ÂéüÊù•Ë¶ÅËÆøÈóÆÁöÑÈ°µÈù¢
                        const redirect = route.query.redirect || '/';
                        router.push(redirect);
                    } else {
                        alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                    }
                };
                
                return {
                    username,
                    password,
                    login
                };
            }
        };

        // Ë∑ØÁî±ÈÖçÁΩÆ
        const routes = [
            { 
                path: '/', 
                component: Home,
                meta: { title: 'È¶ñÈ°µ' }
            },
            { 
                path: '/public', 
                component: PublicPage,
                meta: { title: 'ÂÖ¨ÂºÄÈ°µÈù¢' }
            },
            { 
                path: '/protected', 
                component: ProtectedPage,
                meta: { requiresAuth: true, title: 'Âèó‰øùÊä§È°µÈù¢' }
            },
            {
                path: '/admin',
                component: AdminPage,
                beforeEnter: (to, from, next) => {
                    addGuardLog('route', `AdminPage - beforeEnter: Ê£ÄÊü•ÁÆ°ÁêÜÂëòÊùÉÈôê`);
                    globalState.stats.totalNavigations++;
                    
                    if (!globalState.currentUser.isAuthenticated) {
                        addGuardLog('route', `AdminPage - beforeEnter: Áî®Êà∑Êú™ÁôªÂΩïÔºåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ`);
                        globalState.stats.redirectedNavigations++;
                        next(`/login?redirect=${to.fullPath}`);
                    } else if (!hasPermission('admin')) {
                        addGuardLog('route', `AdminPage - beforeEnter: ÊùÉÈôê‰∏çË∂≥ÔºåÊãíÁªùËÆøÈóÆ`);
                        globalState.stats.blockedNavigations++;
                        next('/unauthorized');
                    } else {
                        addGuardLog('route', `AdminPage - beforeEnter: ÊùÉÈôêÈ™åËØÅÈÄöËøá`);
                        globalState.stats.successfulNavigations++;
                        next();
                    }
                },
                meta: { requiresAuth: true, requiredRole: 'admin', title: 'ÁÆ°ÁêÜÂêéÂè∞' }
            },
            { 
                path: '/user/profile', 
                component: UserProfile,
                meta: { requiresAuth: true, title: '‰∏™‰∫∫ËµÑÊñô' }
            },
            { 
                path: '/analytics', 
                component: AnalyticsPage,
                meta: { requiresAuth: true, title: 'Êï∞ÊçÆÂàÜÊûê' }
            },
            { 
                path: '/login', 
                component: LoginPage,
                meta: { title: 'ÁôªÂΩï' }
            },
            { 
                path: '/unauthorized', 
                component: UnauthorizedPage,
                meta: { title: 'ËÆøÈóÆË¢´ÊãíÁªù' }
            }
        ];

        // ÂàõÂª∫Ë∑ØÁî±Âô®
        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        // ÂÖ®Â±ÄÂâçÁΩÆÂÆàÂç´
        router.beforeEach((to, from, next) => {
            addGuardLog('global', `beforeEach: ‰ªé ${from.path} ÂØºËà™Âà∞ ${to.path}`);
            globalState.stats.totalNavigations++;
            
            // ËÆæÁΩÆÈ°µÈù¢Ê†áÈ¢ò
            if (to.meta.title) {
                document.title = `${to.meta.title} - Ë∑ØÁî±ÂÆàÂç´Á≥ªÁªü`;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËÆ§ËØÅ
            if (to.meta.requiresAuth) {
                if (!globalState.currentUser.isAuthenticated) {
                    addGuardLog('global', `beforeEach: ÈúÄË¶ÅÁôªÂΩïÔºåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ`);
                    globalState.stats.redirectedNavigations++;
                    next(`/login?redirect=${to.fullPath}`);
                    return;
                }
                
                // Ê£ÄÊü•ËßíËâ≤ÊùÉÈôê
                if (to.meta.requiredRole && !hasPermission(to.meta.requiredRole)) {
                    addGuardLog('global', `beforeEach: ÊùÉÈôê‰∏çË∂≥ÔºåÊãíÁªùËÆøÈóÆ`);
                    globalState.stats.blockedNavigations++;
                    next('/unauthorized');
                    return;
                }
            }
            
            addGuardLog('global', `beforeEach: ÂØºËà™È™åËØÅÈÄöËøá`);
            globalState.stats.successfulNavigations++;
            next();
        });

        // ÂÖ®Â±ÄËß£ÊûêÂÆàÂç´
        router.beforeResolve((to, from, next) => {
            addGuardLog('global', `beforeResolve: Ëß£Êûê ${to.path} Ë∑ØÁî±`);
            next();
        });

        // ÂÖ®Â±ÄÂêéÁΩÆÈí©Â≠ê
        router.afterEach((to, from) => {
            addGuardLog('global', `afterEach: ÂÆåÊàê‰ªé ${from.path} Âà∞ ${to.path} ÁöÑÂØºËà™`);
            
            // ËÆ∞ÂΩïËÆøÈóÆÊó•Âøó
            console.log(`È°µÈù¢ËÆøÈóÆËÆ∞ÂΩï: ${to.path} - ${new Date().toISOString()}`);
        });

        // ÂàõÂª∫Â∫îÁî®
        const app = createApp({
            setup() {
                const currentUser = globalState.currentUser;
                const guardLogs = globalState.guardLogs;
                const stats = globalState.stats;
                
                const getRoleText = (role) => {
                    const roleMap = { guest: 'ËÆøÂÆ¢', user: 'Áî®Êà∑', admin: 'ÁÆ°ÁêÜÂëò' };
                    return roleMap[role] || 'Êú™Áü•';
                };
                
                const toggleRole = () => {
                    const roles = ['guest', 'user', 'admin'];
                    const currentIndex = roles.indexOf(currentUser.role);
                    const nextIndex = (currentIndex + 1) % roles.length;
                    currentUser.role = roles[nextIndex];
                    
                    addGuardLog('global', `ËßíËâ≤ÂàáÊç¢‰∏∫: ${getRoleText(currentUser.role)}`);
                };
                
                const logout = () => {
                    currentUser.isAuthenticated = false;
                    currentUser.role = 'guest';
                    currentUser.name = 'Ê∏∏ÂÆ¢';
                    
                    addGuardLog('global', 'Áî®Êà∑Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
                    
                    // Â¶ÇÊûúÂΩìÂâçÂú®Âèó‰øùÊä§È°µÈù¢ÔºåÈáçÂÆöÂêëÂà∞È¶ñÈ°µ
                    const route = router.currentRoute.value;
                    if (route.meta.requiresAuth) {
                        router.push('/');
                    }
                };
                
                const clearLogs = () => {
                    globalState.guardLogs.splice(0);
                    addGuardLog('global', 'Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫');
                };
                
                return {
                    currentUser,
                    guardLogs,
                    stats,
                    getRoleText,
                    toggleRole,
                    logout,
                    clearLogs
                };
            }
        });

        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>