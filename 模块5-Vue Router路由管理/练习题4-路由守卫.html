<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Router è·¯ç”±å®ˆå«ç»ƒä¹ </title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.router-link-active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .permission-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .permission-admin {
            background: #ffeaa7;
            color: #856404;
        }

        .permission-user {
            background: #a8e6cf;
            color: #155724;
        }

        .permission-guest {
            background: #ddd6fe;
            color: #553c9a;
        }

        .route-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }

        .breadcrumb {
            background: rgba(255, 255, 255, 0.7);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .guard-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .guard-log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .guard-log-entry:last-child {
            border-bottom: none;
        }

        .guard-log-time {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .guard-log-type {
            font-weight: bold;
            margin: 0 0.5rem;
        }

        .guard-log-global {
            color: #007bff;
        }

        .guard-log-route {
            color: #28a745;
        }

        .guard-log-component {
            color: #ffc107;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <header class="header">
            <nav class="nav">
                <div class="logo">ğŸ›¡ï¸ è·¯ç”±å®ˆå«ç³»ç»Ÿ</div>
                <ul class="nav-links">
                    <li><router-link to="/">é¦–é¡µ</router-link></li>
                    <li><router-link to="/public">å…¬å¼€é¡µé¢</router-link></li>
                    <li><router-link to="/protected">å—ä¿æŠ¤é¡µé¢</router-link></li>
                    <li><router-link to="/admin">ç®¡ç†åå°</router-link></li>
                    <li><router-link to="/user/profile">ç”¨æˆ·ä¸­å¿ƒ</router-link></li>
                    <li><router-link to="/analytics">æ•°æ®åˆ†æ</router-link></li>
                </ul>
                <div class="user-info">
                    <div class="user-avatar">{{ currentUser.name.charAt(0) }}</div>
                    <span>{{ currentUser.name }}</span>
                    <span class="permission-badge" :class="`permission-${currentUser.role}`">
                        {{ getRoleText(currentUser.role) }}
                    </span>
                    <button @click="toggleRole" class="btn btn-secondary">åˆ‡æ¢è§’è‰²</button>
                    <button @click="logout" class="btn btn-danger">é€€å‡º</button>
                </div>
            </nav>
        </header>

        <main class="main-content">
            <!-- è·¯ç”±å®ˆå«æ—¥å¿— -->
            <div class="card">
                <h3>ğŸ” è·¯ç”±å®ˆå«æ‰§è¡Œæ—¥å¿—</h3>
                <div class="guard-log">
                    <div v-for="log in guardLogs" :key="log.id" class="guard-log-entry">
                        <span class="guard-log-time">{{ log.time }}</span>
                        <span class="guard-log-type" :class="`guard-log-${log.type}`">
                            {{ log.type.toUpperCase() }}
                        </span>
                        <span>{{ log.message }}</span>
                    </div>
                </div>
                <button @click="clearLogs" class="btn btn-secondary" style="margin-top: 1rem;">æ¸…ç©ºæ—¥å¿—</button>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ stats.totalNavigations }}</div>
                    <div class="stat-label">æ€»å¯¼èˆªæ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.blockedNavigations }}</div>
                    <div class="stat-label">è¢«é˜»æ­¢çš„å¯¼èˆª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.successfulNavigations }}</div>
                    <div class="stat-label">æˆåŠŸçš„å¯¼èˆª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ stats.redirectedNavigations }}</div>
                    <div class="stat-label">é‡å®šå‘çš„å¯¼èˆª</div>
                </div>
            </div>

            <!-- è·¯ç”±è§†å›¾ -->
            <router-view></router-view>
        </main>
    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
        const { createRouter, createWebHashHistory, useRoute, useRouter, onBeforeRouteEnter, onBeforeRouteUpdate, onBeforeRouteLeave } = VueRouter;

        // å…¨å±€çŠ¶æ€ç®¡ç†
        const globalState = reactive({
            currentUser: {
                id: 1,
                name: 'å¼ ä¸‰',
                role: 'user', // guest, user, admin
                isAuthenticated: true
            },
            guardLogs: [],
            stats: {
                totalNavigations: 0,
                blockedNavigations: 0,
                successfulNavigations: 0,
                redirectedNavigations: 0
            },
            logId: 1
        });

        // å·¥å…·å‡½æ•°
        const addGuardLog = (type, message) => {
            const now = new Date();
            const time = now.toLocaleTimeString();
            globalState.guardLogs.unshift({
                id: globalState.logId++,
                type,
                message,
                time
            });
            // åªä¿ç•™æœ€è¿‘50æ¡æ—¥å¿—
            if (globalState.guardLogs.length > 50) {
                globalState.guardLogs.pop();
            }
        };

        const hasPermission = (requiredRole) => {
            const roleHierarchy = { guest: 0, user: 1, admin: 2 };
            const userLevel = roleHierarchy[globalState.currentUser.role] || 0;
            const requiredLevel = roleHierarchy[requiredRole] || 0;
            return userLevel >= requiredLevel;
        };

        const simulateAsyncCheck = (delay = 1000) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(Math.random() > 0.1); // 90% æˆåŠŸç‡
                }, delay);
            });
        };

        // ç»„ä»¶å®šä¹‰
        const Home = {
            template: `
                <div class="card">
                    <h2>ğŸ  é¦–é¡µ</h2>
                    <p>æ¬¢è¿æ¥åˆ°Vue Routerè·¯ç”±å®ˆå«ç»ƒä¹ ç³»ç»Ÿï¼</p>
                    
                    <div class="route-info">
                        <h4>ğŸ“‹ ç»ƒä¹ å†…å®¹</h4>
                        <ul>
                            <li><strong>å…¨å±€å‰ç½®å®ˆå«ï¼š</strong>åœ¨æ¯æ¬¡è·¯ç”±è·³è½¬å‰æ‰§è¡Œæƒé™æ£€æŸ¥</li>
                            <li><strong>å…¨å±€åç½®é’©å­ï¼š</strong>åœ¨è·¯ç”±è·³è½¬å®Œæˆåè®°å½•è®¿é—®æ—¥å¿—</li>
                            <li><strong>è·¯ç”±ç‹¬äº«å®ˆå«ï¼š</strong>ä¸ºç‰¹å®šè·¯ç”±é…ç½®ä¸“é—¨çš„å®ˆå«é€»è¾‘</li>
                            <li><strong>ç»„ä»¶å†…å®ˆå«ï¼š</strong>åœ¨ç»„ä»¶å†…éƒ¨å¤„ç†è·¯ç”±å˜åŒ–</li>
                            <li><strong>å¼‚æ­¥è·¯ç”±å®ˆå«ï¼š</strong>å¤„ç†éœ€è¦å¼‚æ­¥éªŒè¯çš„åœºæ™¯</li>
                            <li><strong>æƒé™æ§åˆ¶ï¼š</strong>åŸºäºç”¨æˆ·è§’è‰²çš„è®¿é—®æ§åˆ¶</li>
                        </ul>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>ğŸ”“ å…¬å¼€é¡µé¢</h4>
                            <p>æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®çš„é¡µé¢</p>
                            <router-link to="/public" class="btn btn-primary">è®¿é—®å…¬å¼€é¡µé¢</router-link>
                        </div>
                        <div class="card">
                            <h4>ğŸ”’ å—ä¿æŠ¤é¡µé¢</h4>
                            <p>éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„é¡µé¢</p>
                            <router-link to="/protected" class="btn btn-primary">è®¿é—®å—ä¿æŠ¤é¡µé¢</router-link>
                        </div>
                        <div class="card">
                            <h4>ğŸ‘‘ ç®¡ç†åå°</h4>
                            <p>åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®çš„é¡µé¢</p>
                            <router-link to="/admin" class="btn btn-primary">è®¿é—®ç®¡ç†åå°</router-link>
                        </div>
                    </div>
                </div>
            `
        };

        const PublicPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">é¦–é¡µ</router-link> / å…¬å¼€é¡µé¢
                    </div>
                    
                    <h2>ğŸ”“ å…¬å¼€é¡µé¢</h2>
                    <div class="alert alert-info">
                        <strong>â„¹ï¸ æç¤ºï¼š</strong>è¿™æ˜¯ä¸€ä¸ªå…¬å¼€é¡µé¢ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ï¼Œæ— éœ€ç‰¹æ®Šæƒé™ã€‚
                    </div>
                    
                    <p>è¿™ä¸ªé¡µé¢æ¼”ç¤ºäº†æ— éœ€æƒé™éªŒè¯çš„è·¯ç”±ã€‚ä»»ä½•ç”¨æˆ·ï¼Œæ— è®ºæ˜¯å¦ç™»å½•ï¼Œéƒ½å¯ä»¥è®¿é—®è¿™ä¸ªé¡µé¢ã€‚</p>
                    
                    <div class="route-info">
                        <h4>ğŸ›¡ï¸ è·¯ç”±å®ˆå«é…ç½®</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/public',
  component: PublicPage,
  meta: { 
    requiresAuth: false,
    title: 'å…¬å¼€é¡µé¢'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>ğŸ“Š è®¿é—®ç»Ÿè®¡</h4>
                            <p>ä»Šæ—¥è®¿é—®é‡ï¼š<strong>1,234</strong></p>
                            <p>æ€»è®¿é—®é‡ï¼š<strong>45,678</strong></p>
                        </div>
                        <div class="card">
                            <h4>ğŸ“¢ å…¬å‘Š</h4>
                            <p>æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„ç³»ç»Ÿï¼å¦‚æœ‰é—®é¢˜è¯·è”ç³»å®¢æœã€‚</p>
                        </div>
                    </div>
                </div>
            `,
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `PublicPage - beforeRouteEnter: ä» ${from.path} è¿›å…¥ ${to.path}`);
                next();
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `PublicPage - beforeRouteLeave: ä» ${from.path} ç¦»å¼€åˆ° ${to.path}`);
                next();
            }
        };

        const ProtectedPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">é¦–é¡µ</router-link> / å—ä¿æŠ¤é¡µé¢
                    </div>
                    
                    <h2>ğŸ”’ å—ä¿æŠ¤é¡µé¢</h2>
                    <div class="alert alert-success">
                        <strong>âœ… æˆåŠŸï¼š</strong>æ‚¨å·²é€šè¿‡èº«ä»½éªŒè¯ï¼Œå¯ä»¥è®¿é—®æ­¤å—ä¿æŠ¤çš„é¡µé¢ã€‚
                    </div>
                    
                    <p>è¿™ä¸ªé¡µé¢éœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®ã€‚å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œä¼šè¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚</p>
                    
                    <div class="route-info">
                        <h4>ğŸ›¡ï¸ è·¯ç”±å®ˆå«é…ç½®</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/protected',
  component: ProtectedPage,
  meta: { 
    requiresAuth: true,
    title: 'å—ä¿æŠ¤é¡µé¢'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h4>
                            <p>ç”¨æˆ·åï¼š<strong>{{ currentUser.name }}</strong></p>
                            <p>è§’è‰²ï¼š<strong>{{ getRoleText(currentUser.role) }}</strong></p>
                            <p>ç™»å½•çŠ¶æ€ï¼š<strong>{{ currentUser.isAuthenticated ? 'å·²ç™»å½•' : 'æœªç™»å½•' }}</strong></p>
                        </div>
                        <div class="card">
                            <h4>ğŸ” å®‰å…¨ä¿¡æ¯</h4>
                            <p>æœ€åç™»å½•ï¼š<strong>2024-01-15 10:30:00</strong></p>
                            <p>ç™»å½•IPï¼š<strong>192.168.1.100</strong></p>
                            <p>ä¼šè¯æœ‰æ•ˆæœŸï¼š<strong>2å°æ—¶</strong></p>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                return {
                    currentUser: globalState.currentUser,
                    getRoleText: (role) => {
                        const roleMap = { guest: 'è®¿å®¢', user: 'ç”¨æˆ·', admin: 'ç®¡ç†å‘˜' };
                        return roleMap[role] || 'æœªçŸ¥';
                    }
                };
            },
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `ProtectedPage - beforeRouteEnter: æ£€æŸ¥ç”¨æˆ·æƒé™`);
                if (globalState.currentUser.isAuthenticated) {
                    next();
                } else {
                    addGuardLog('component', `ProtectedPage - beforeRouteEnter: ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ`);
                    next('/login');
                }
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `ProtectedPage - beforeRouteLeave: ç¦»å¼€å—ä¿æŠ¤é¡µé¢`);
                next();
            }
        };

        const AdminPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">é¦–é¡µ</router-link> / ç®¡ç†åå°
                    </div>
                    
                    <h2>ğŸ‘‘ ç®¡ç†åå°</h2>
                    <div class="alert alert-warning">
                        <strong>âš ï¸ è­¦å‘Šï¼š</strong>è¿™æ˜¯ç®¡ç†å‘˜ä¸“ç”¨é¡µé¢ï¼ŒåŒ…å«æ•æ„Ÿæ“ä½œï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚
                    </div>
                    
                    <p>è¿™ä¸ªé¡µé¢åªæœ‰ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·æ‰èƒ½è®¿é—®ã€‚æ™®é€šç”¨æˆ·ä¼šè¢«æ‹’ç»è®¿é—®ã€‚</p>
                    
                    <div class="route-info">
                        <h4>ğŸ›¡ï¸ è·¯ç”±å®ˆå«é…ç½®</h4>
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">{
  path: '/admin',
  component: AdminPage,
  beforeEnter: (to, from, next) => {
    if (hasPermission('admin')) {
      next();
    } else {
      next('/unauthorized');
    }
  },
  meta: { 
    requiresAuth: true,
    requiredRole: 'admin',
    title: 'ç®¡ç†åå°'
  }
}</pre>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h4>
                            <p>æ€»ç”¨æˆ·æ•°ï¼š<strong>1,234</strong></p>
                            <p>æ´»è·ƒç”¨æˆ·ï¼š<strong>856</strong></p>
                            <button class="btn btn-primary">ç®¡ç†ç”¨æˆ·</button>
                        </div>
                        <div class="card">
                            <h4>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h4>
                            <p>ä»Šæ—¥è®¿é—®ï¼š<strong>5,678</strong></p>
                            <p>ç³»ç»Ÿè´Ÿè½½ï¼š<strong>45%</strong></p>
                            <button class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</button>
                        </div>
                        <div class="card">
                            <h4>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h4>
                            <p>ç³»ç»Ÿç‰ˆæœ¬ï¼š<strong>v2.1.0</strong></p>
                            <p>æ•°æ®åº“çŠ¶æ€ï¼š<strong>æ­£å¸¸</strong></p>
                            <button class="btn btn-primary">ç³»ç»Ÿé…ç½®</button>
                        </div>
                        <div class="card">
                            <h4>ğŸ”’ å®‰å…¨ä¸­å¿ƒ</h4>
                            <p>å®‰å…¨ç­‰çº§ï¼š<strong>é«˜</strong></p>
                            <p>å¨èƒæ£€æµ‹ï¼š<strong>0ä¸ª</strong></p>
                            <button class="btn btn-primary">å®‰å…¨è®¾ç½®</button>
                        </div>
                    </div>
                </div>
            `,
            beforeRouteEnter(to, from, next) {
                addGuardLog('component', `AdminPage - beforeRouteEnter: éªŒè¯ç®¡ç†å‘˜æƒé™`);
                next();
            },
            beforeRouteLeave(to, from, next) {
                addGuardLog('component', `AdminPage - beforeRouteLeave: ç¦»å¼€ç®¡ç†åå°`);
                // æ¨¡æ‹Ÿç¡®è®¤å¯¹è¯æ¡†
                const confirmed = confirm('æ‚¨ç¡®å®šè¦ç¦»å¼€ç®¡ç†åå°å—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¸¢å¤±ã€‚');
                if (confirmed) {
                    next();
                } else {
                    next(false);
                }
            }
        };

        const UserProfile = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">é¦–é¡µ</router-link> / ç”¨æˆ·ä¸­å¿ƒ / ä¸ªäººèµ„æ–™
                    </div>
                    
                    <h2>ğŸ‘¤ ä¸ªäººèµ„æ–™</h2>
                    <div class="alert alert-info">
                        <strong>â„¹ï¸ æç¤ºï¼š</strong>è¿™é‡Œå¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h4>ğŸ“ åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="form-group">
                                <label>ç”¨æˆ·å</label>
                                <input type="text" :value="currentUser.name" readonly>
                            </div>
                            <div class="form-group">
                                <label>è§’è‰²</label>
                                <input type="text" :value="getRoleText(currentUser.role)" readonly>
                            </div>
                            <div class="form-group">
                                <label>é‚®ç®±</label>
                                <input type="email" value="zhangsan@example.com">
                            </div>
                            <div class="form-group">
                                <label>ç”µè¯</label>
                                <input type="tel" value="138-0000-0000">
                            </div>
                            <button class="btn btn-primary">ä¿å­˜æ›´æ”¹</button>
                        </div>
                        
                        <div class="card">
                            <h4>ğŸ” å®‰å…¨è®¾ç½®</h4>
                            <div class="form-group">
                                <label>å½“å‰å¯†ç </label>
                                <input type="password" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                            </div>
                            <div class="form-group">
                                <label>æ–°å¯†ç </label>
                                <input type="password" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                            </div>
                            <div class="form-group">
                                <label>ç¡®è®¤æ–°å¯†ç </label>
                                <input type="password" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                            </div>
                            <button class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const route = useRoute();
                
                onBeforeRouteUpdate((to, from) => {
                    addGuardLog('component', `UserProfile - beforeRouteUpdate: è·¯ç”±å‚æ•°å˜åŒ– ${from.params.id} -> ${to.params.id}`);
                });
                
                return {
                    currentUser: globalState.currentUser,
                    getRoleText: (role) => {
                        const roleMap = { guest: 'è®¿å®¢', user: 'ç”¨æˆ·', admin: 'ç®¡ç†å‘˜' };
                        return roleMap[role] || 'æœªçŸ¥';
                    }
                };
            }
        };

        const AnalyticsPage = {
            template: `
                <div class="card">
                    <div class="breadcrumb">
                        <router-link to="/">é¦–é¡µ</router-link> / æ•°æ®åˆ†æ
                    </div>
                    
                    <h2>ğŸ“Š æ•°æ®åˆ†æ</h2>
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                        <span style="margin-left: 1rem;">æ­£åœ¨åŠ è½½æ•°æ®...</span>
                    </div>
                    
                    <div v-else>
                        <div class="alert alert-success">
                            <strong>âœ… æˆåŠŸï¼š</strong>æ•°æ®åŠ è½½å®Œæˆï¼Œå¼‚æ­¥è·¯ç”±å®ˆå«éªŒè¯é€šè¿‡ã€‚
                        </div>
                        
                        <div class="route-info">
                            <h4>ğŸ›¡ï¸ å¼‚æ­¥è·¯ç”±å®ˆå«</h4>
                            <p>è¿™ä¸ªé¡µé¢æ¼”ç¤ºäº†å¼‚æ­¥è·¯ç”±å®ˆå«çš„ä½¿ç”¨ã€‚åœ¨è¿›å…¥é¡µé¢å‰ï¼Œä¼šå¼‚æ­¥éªŒè¯ç”¨æˆ·æƒé™å’Œæ•°æ®å¯ç”¨æ€§ã€‚</p>
                        </div>
                        
                        <div class="grid">
                            <div class="card">
                                <h4>ğŸ“ˆ è®¿é—®è¶‹åŠ¿</h4>
                                <p>ä»Šæ—¥è®¿é—®ï¼š<strong>2,345</strong> (+12%)</p>
                                <p>æ˜¨æ—¥è®¿é—®ï¼š<strong>2,089</strong></p>
                                <p>æœ¬å‘¨è®¿é—®ï¼š<strong>15,678</strong></p>
                            </div>
                            <div class="card">
                                <h4>ğŸ‘¥ ç”¨æˆ·åˆ†æ</h4>
                                <p>æ–°ç”¨æˆ·ï¼š<strong>123</strong></p>
                                <p>æ´»è·ƒç”¨æˆ·ï¼š<strong>1,456</strong></p>
                                <p>ç•™å­˜ç‡ï¼š<strong>78%</strong></p>
                            </div>
                            <div class="card">
                                <h4>ğŸŒ åœ°åŸŸåˆ†å¸ƒ</h4>
                                <p>åŒ—äº¬ï¼š<strong>35%</strong></p>
                                <p>ä¸Šæµ·ï¼š<strong>28%</strong></p>
                                <p>å¹¿å·ï¼š<strong>15%</strong></p>
                                <p>å…¶ä»–ï¼š<strong>22%</strong></p>
                            </div>
                            <div class="card">
                                <h4>ğŸ“± è®¾å¤‡åˆ†æ</h4>
                                <p>æ¡Œé¢ç«¯ï¼š<strong>65%</strong></p>
                                <p>ç§»åŠ¨ç«¯ï¼š<strong>30%</strong></p>
                                <p>å¹³æ¿ï¼š<strong>5%</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const loading = ref(true);
                
                onMounted(() => {
                    // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
                    setTimeout(() => {
                        loading.value = false;
                    }, 2000);
                });
                
                return { loading };
            },
            async beforeRouteEnter(to, from, next) {
                addGuardLog('component', `AnalyticsPage - beforeRouteEnter: å¼€å§‹å¼‚æ­¥éªŒè¯`);
                
                try {
                    // æ¨¡æ‹Ÿå¼‚æ­¥æƒé™æ£€æŸ¥
                    const hasAccess = await simulateAsyncCheck(1500);
                    
                    if (hasAccess) {
                        addGuardLog('component', `AnalyticsPage - beforeRouteEnter: å¼‚æ­¥éªŒè¯æˆåŠŸ`);
                        next();
                    } else {
                        addGuardLog('component', `AnalyticsPage - beforeRouteEnter: å¼‚æ­¥éªŒè¯å¤±è´¥ï¼Œæ‹’ç»è®¿é—®`);
                        next('/unauthorized');
                    }
                } catch (error) {
                    addGuardLog('component', `AnalyticsPage - beforeRouteEnter: å¼‚æ­¥éªŒè¯å‡ºé”™ - ${error.message}`);
                    next('/error');
                }
            }
        };

        const UnauthorizedPage = {
            template: `
                <div class="card">
                    <div class="alert alert-danger">
                        <h2>ğŸš« è®¿é—®è¢«æ‹’ç»</h2>
                        <p><strong>æŠ±æ­‰ï¼Œæ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤é¡µé¢ã€‚</strong></p>
                    </div>
                    
                    <div class="route-info">
                        <h4>å¯èƒ½çš„åŸå› ï¼š</h4>
                        <ul>
                            <li>æ‚¨çš„è´¦æˆ·æƒé™ä¸è¶³</li>
                            <li>éœ€è¦æ›´é«˜çº§åˆ«çš„ç”¨æˆ·è§’è‰²</li>
                            <li>é¡µé¢éœ€è¦ç‰¹æ®Šæˆæƒ</li>
                            <li>ä¼šè¯å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <router-link to="/" class="btn btn-primary">è¿”å›é¦–é¡µ</router-link>
                        <button @click="requestAccess" class="btn btn-secondary" style="margin-left: 1rem;">ç”³è¯·æƒé™</button>
                    </div>
                </div>
            `,
            setup() {
                const requestAccess = () => {
                    alert('æƒé™ç”³è¯·å·²æäº¤ï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚');
                };
                
                return { requestAccess };
            }
        };

        const LoginPage = {
            template: `
                <div class="card">
                    <h2>ğŸ” ç”¨æˆ·ç™»å½•</h2>
                    <div class="alert alert-info">
                        <strong>â„¹ï¸ æç¤ºï¼š</strong>è¯·ç™»å½•ä»¥è®¿é—®å—ä¿æŠ¤çš„é¡µé¢ã€‚
                    </div>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <div class="form-group">
                            <label>ç”¨æˆ·å</label>
                            <input type="text" v-model="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                        </div>
                        <div class="form-group">
                            <label>å¯†ç </label>
                            <input type="password" v-model="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                        </div>
                        <button @click="login" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
                    </div>
                    
                    <div class="route-info" style="margin-top: 2rem;">
                        <h4>ğŸ§ª æµ‹è¯•è´¦æˆ·</h4>
                        <p>ç”¨æˆ·åï¼šuser / å¯†ç ï¼š123456 ï¼ˆæ™®é€šç”¨æˆ·ï¼‰</p>
                        <p>ç”¨æˆ·åï¼šadmin / å¯†ç ï¼š123456 ï¼ˆç®¡ç†å‘˜ï¼‰</p>
                    </div>
                </div>
            `,
            setup() {
                const router = useRouter();
                const route = useRoute();
                const username = ref('');
                const password = ref('');
                
                const login = () => {
                    if (username.value && password.value) {
                        // æ¨¡æ‹Ÿç™»å½•é€»è¾‘
                        globalState.currentUser.isAuthenticated = true;
                        globalState.currentUser.name = username.value;
                        globalState.currentUser.role = username.value === 'admin' ? 'admin' : 'user';
                        
                        addGuardLog('global', `ç”¨æˆ· ${username.value} ç™»å½•æˆåŠŸ`);
                        
                        // é‡å®šå‘åˆ°åŸæ¥è¦è®¿é—®çš„é¡µé¢
                        const redirect = route.query.redirect || '/';
                        router.push(redirect);
                    } else {
                        alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                    }
                };
                
                return {
                    username,
                    password,
                    login
                };
            }
        };

        // è·¯ç”±é…ç½®
        const routes = [
            { 
                path: '/', 
                component: Home,
                meta: { title: 'é¦–é¡µ' }
            },
            { 
                path: '/public', 
                component: PublicPage,
                meta: { title: 'å…¬å¼€é¡µé¢' }
            },
            { 
                path: '/protected', 
                component: ProtectedPage,
                meta: { requiresAuth: true, title: 'å—ä¿æŠ¤é¡µé¢' }
            },
            {
                path: '/admin',
                component: AdminPage,
                beforeEnter: (to, from, next) => {
                    addGuardLog('route', `AdminPage - beforeEnter: æ£€æŸ¥ç®¡ç†å‘˜æƒé™`);
                    globalState.stats.totalNavigations++;
                    
                    if (!globalState.currentUser.isAuthenticated) {
                        addGuardLog('route', `AdminPage - beforeEnter: ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ`);
                        globalState.stats.redirectedNavigations++;
                        next(`/login?redirect=${to.fullPath}`);
                    } else if (!hasPermission('admin')) {
                        addGuardLog('route', `AdminPage - beforeEnter: æƒé™ä¸è¶³ï¼Œæ‹’ç»è®¿é—®`);
                        globalState.stats.blockedNavigations++;
                        next('/unauthorized');
                    } else {
                        addGuardLog('route', `AdminPage - beforeEnter: æƒé™éªŒè¯é€šè¿‡`);
                        globalState.stats.successfulNavigations++;
                        next();
                    }
                },
                meta: { requiresAuth: true, requiredRole: 'admin', title: 'ç®¡ç†åå°' }
            },
            { 
                path: '/user/profile', 
                component: UserProfile,
                meta: { requiresAuth: true, title: 'ä¸ªäººèµ„æ–™' }
            },
            { 
                path: '/analytics', 
                component: AnalyticsPage,
                meta: { requiresAuth: true, title: 'æ•°æ®åˆ†æ' }
            },
            { 
                path: '/login', 
                component: LoginPage,
                meta: { title: 'ç™»å½•' }
            },
            { 
                path: '/unauthorized', 
                component: UnauthorizedPage,
                meta: { title: 'è®¿é—®è¢«æ‹’ç»' }
            }
        ];

        // åˆ›å»ºè·¯ç”±å™¨
        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        // å…¨å±€å‰ç½®å®ˆå«
        router.beforeEach((to, from, next) => {
            addGuardLog('global', `beforeEach: ä» ${from.path} å¯¼èˆªåˆ° ${to.path}`);
            globalState.stats.totalNavigations++;
            
            // è®¾ç½®é¡µé¢æ ‡é¢˜
            if (to.meta.title) {
                document.title = `${to.meta.title} - è·¯ç”±å®ˆå«ç³»ç»Ÿ`;
            }
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦è®¤è¯
            if (to.meta.requiresAuth) {
                if (!globalState.currentUser.isAuthenticated) {
                    addGuardLog('global', `beforeEach: éœ€è¦ç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ`);
                    globalState.stats.redirectedNavigations++;
                    next(`/login?redirect=${to.fullPath}`);
                    return;
                }
                
                // æ£€æŸ¥è§’è‰²æƒé™
                if (to.meta.requiredRole && !hasPermission(to.meta.requiredRole)) {
                    addGuardLog('global', `beforeEach: æƒé™ä¸è¶³ï¼Œæ‹’ç»è®¿é—®`);
                    globalState.stats.blockedNavigations++;
                    next('/unauthorized');
                    return;
                }
            }
            
            addGuardLog('global', `beforeEach: å¯¼èˆªéªŒè¯é€šè¿‡`);
            globalState.stats.successfulNavigations++;
            next();
        });

        // å…¨å±€è§£æå®ˆå«
        router.beforeResolve((to, from, next) => {
            addGuardLog('global', `beforeResolve: è§£æ ${to.path} è·¯ç”±`);
            next();
        });

        // å…¨å±€åç½®é’©å­
        router.afterEach((to, from) => {
            addGuardLog('global', `afterEach: å®Œæˆä» ${from.path} åˆ° ${to.path} çš„å¯¼èˆª`);
            
            // è®°å½•è®¿é—®æ—¥å¿—
            console.log(`é¡µé¢è®¿é—®è®°å½•: ${to.path} - ${new Date().toISOString()}`);
        });

        // åˆ›å»ºåº”ç”¨
        const app = createApp({
            setup() {
                const currentUser = globalState.currentUser;
                const guardLogs = globalState.guardLogs;
                const stats = globalState.stats;
                
                const getRoleText = (role) => {
                    const roleMap = { guest: 'è®¿å®¢', user: 'ç”¨æˆ·', admin: 'ç®¡ç†å‘˜' };
                    return roleMap[role] || 'æœªçŸ¥';
                };
                
                const toggleRole = () => {
                    const roles = ['guest', 'user', 'admin'];
                    const currentIndex = roles.indexOf(currentUser.role);
                    const nextIndex = (currentIndex + 1) % roles.length;
                    currentUser.role = roles[nextIndex];
                    
                    addGuardLog('global', `è§’è‰²åˆ‡æ¢ä¸º: ${getRoleText(currentUser.role)}`);
                };
                
                const logout = () => {
                    currentUser.isAuthenticated = false;
                    currentUser.role = 'guest';
                    currentUser.name = 'æ¸¸å®¢';
                    
                    addGuardLog('global', 'ç”¨æˆ·å·²é€€å‡ºç™»å½•');
                    
                    // å¦‚æœå½“å‰åœ¨å—ä¿æŠ¤é¡µé¢ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
                    const route = router.currentRoute.value;
                    if (route.meta.requiresAuth) {
                        router.push('/');
                    }
                };
                
                const clearLogs = () => {
                    globalState.guardLogs.splice(0);
                    addGuardLog('global', 'æ—¥å¿—å·²æ¸…ç©º');
                };
                
                return {
                    currentUser,
                    guardLogs,
                    stats,
                    getRoleText,
                    toggleRole,
                    logout,
                    clearLogs
                };
            }
        });

        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>